% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/stat_pca.R
\name{stat_pca}
\alias{stat_pca}
\title{Principal Component Analysis for morphometric data}
\usage{
stat_pca(data, formula = NULL, center = TRUE, scale = NULL, ...)
}
\arguments{
\item{data}{A tibble with coefficient columns}

\item{formula}{A formula specifying predictors. Can be:
\itemize{
\item Missing: auto-detects single coe column
\item Bare column name: \code{coe}
\item Formula: \code{~ coe}, \code{~ coe + size}, \code{~ coe1 + coe2}
\item Use \code{coe} in formula to auto-detect coefficient columns
}}

\item{center}{Logical. Should data be centered? Default \code{TRUE}.}

\item{scale}{Logical or NULL. Should data be scaled to unit variance?
If \code{NULL} (default), automatically determined based on predictor types.}

\item{...}{Additional arguments passed to \code{\link[stats:prcomp]{stats::prcomp()}}}
}
\value{
An object of class \code{c("stat_pca", "momstats")} containing:
\itemize{
\item \code{data}: Original tibble (unchanged)
\item \code{model}: The \code{\link[stats:prcomp]{stats::prcomp()}} object
\item \code{method}: "pca"
\item \code{call}: The function call
\item \code{formula}: Formula used (if any)
\item \code{coe_cols}: Names of coefficient columns used
\item \code{covariate_cols}: Names of covariate columns used (if any)
\item \code{predictor_cols}: All predictor column names
\item \code{group_col}: NULL (no grouping for PCA)
\item \code{variance_explained}: Proportion of variance explained by each PC
\item \code{cumvar_explained}: Cumulative proportion of variance explained
\item \code{center}: Logical, was centering applied
\item \code{scale}: Logical, was scaling applied
}
}
\description{
Perform PCA on coefficient data from morphometric analyses.
}
\details{
\code{stat_pca()} provides a unified interface for PCA on morphometric coefficient
data. It handles:
\itemize{
\item \strong{Automatic coefficient detection}: Finds \code{coe} columns via class
\item \strong{Coefficient unfolding}: Expands list-columns to individual harmonic columns
\item \strong{Multiple coefficient types}: Can combine different coefficient columns
\item \strong{Covariates}: Add non-morphometric predictors (size, environmental variables)
\item \strong{Smart defaults}: Automatically determines centering and scaling
}
\subsection{Formula syntax}{

The formula specifies which predictors to use:
\itemize{
\item \code{~ coe}: Use auto-detected coefficient column(s)
\item \code{~ coe1 + coe2}: Use specific coefficient columns
\item \code{~ coe + size}: Coefficient column plus a covariate
\item Bare name or missing: auto-detect single coe column
}
}

\subsection{Centering and scaling}{
\itemize{
\item \code{center = TRUE} (default): Variables are centered to mean = 0
\item \code{scale = NULL} (default): Automatic determination:
\itemize{
\item Pure EFT coefficients: \code{scale = FALSE}
\item Mixed predictors or non-EFT: \code{scale = TRUE}
}
\item \code{scale = TRUE/FALSE}: Override automatic behavior
}
}

\subsection{Getting results}{

Use \code{\link[=collect]{collect()}} to add PC scores to your data:

\if{html}{\out{<div class="sourceCode r">}}\preformatted{pca <- boteft \%>\% stat_pca()
boteft_with_pcs <- collect(pca, retain = 5)  # Add first 5 PCs
}\if{html}{\out{</div>}}
}
}
\examples{
\dontrun{
# Basic PCA on coefficients
pca1 <- boteft \%>\% stat_pca()

# Explicit column
pca2 <- boteft \%>\% stat_pca(coe)

# Formula syntax
pca3 <- boteft \%>\% stat_pca(~ coe)

# With covariate
pca4 <- boteft \%>\% stat_pca(~ coe + length)

# Force scaling
pca5 <- boteft \%>\% stat_pca(~ coe, scale = TRUE)

# Add PC scores to data
boteft_pca <- collect(pca1, retain = 5)

# Or fold into single column
boteft_pca <- collect(pca1, retain = 5, fold = "pca_scores")

# Plot results
plot(pca1)  # Score plot (default)
plot(pca1, type = "scree")
plot(pca1, type = "loadings")
plot(pca1, color = type)  # Color by grouping variable
plot(pca1, labels = type)  # Text labels
plot(pca1, color = type, chull = TRUE)  # With convex hulls
}

}
\seealso{
\code{\link[stats:prcomp]{stats::prcomp()}}, \code{\link[=collect.stat_pca]{collect.stat_pca()}}, \code{\link[=plot.stat_pca]{plot.stat_pca()}}
}
